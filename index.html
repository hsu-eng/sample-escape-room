<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Haunted Equation Escape</title>
  <style>
    /* Base page styling */
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #f5f5f5;
      font-family: Arial, sans-serif;
    }
    h1 {
      color: #e74c3c;
      margin-top: 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    h2, h3 {
      color: #e74c3c;
      margin-top: 0;
    }
    /* Each game section is full‚Äëscreen, centered content */
    .section {
      display: none;
      min-height: 100vh;
      box-sizing: border-box;
      padding: 30px 20px;
      text-align: center;
    }
    .content {
      max-width: 900px;
      margin: 0 auto;
    }
    /* Video presentation */
    video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 20px;
      background-color: #111; /* fallback color while poster loads */
    }
    /* Audio controls container: cipher button + music toggle */
    .audio-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .music-toggle {
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background-color: #e74c3c;
      color: #fff;
      cursor: pointer;
    }
    .music-toggle:hover {
      background-color: #c0392b;
    }
    /* Cipher button at the bottom of each scene */
    .cipher-button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background-color: #444;
      color: #fff;
      cursor: pointer;
      margin-top: 30px;
    }
    .cipher-button:hover {
      background-color: #555;
    }
    /* Equation images: scale down to fit smaller screens */
    .equation-img {
      width: auto;
      max-width: 90%;
      height: auto;
      max-height: 60vh;
      object-fit: contain;
      margin: 20px auto;
      display: block;
      border-radius: 8px;
    }
    /* Input and action buttons */
    input[type="text"] {
      padding: 10px;
      font-size: 18px;
      width: 200px;
      border-radius: 4px;
      border: 1px solid #e74c3c;
      background-color: #111;
      color: #f5f5f5;
    }
    .action-button {
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 4px;
      background-color: #e74c3c;
      color: #fff;
      cursor: pointer;
      margin-left: 10px;
    }
    .action-button:hover {
      background-color: #c0392b;
    }
    /* Restart and feedback buttons */
    .restart {
      margin-top: 20px;
    }
    .feedback {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <!-- Scene 1: The Awakening -->
  <div id="section1" class="section">
    <div class="content">
      <h1>Scene&nbsp;1: The Awakening</h1>
      <!-- Video: user clicks to play; poster shown until click -->
      <video controls poster="scene1.png">
        <source src="scene1.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <!-- Audio controls: music toggle and hidden audio element -->
      <div class="audio-controls">
        <audio id="music1" class="scene-audio" src="track1.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('music1', this)">Music On</button>
      </div>
      <p>You wake up at your desk in a dark, empty classroom. The clock reads <strong>67:67</strong>&nbsp;&mdash;&nbsp;an impossible time. The door won't budge. A flickering message on the board explains your challenge:</p>
      <p style="font-size:1.3em; color:#e74c3c;">"Solve it before it finds you."</p>
      <p>Below the message, several equations have appeared. Solve each equation for <em>x</em>, convert the number to a letter using <em>A&nbsp;=&nbsp;1, B&nbsp;=&nbsp;2, ...</em>, and unscramble the letters to form the password.</p>
      <img src="equations1.png" alt="Level 1 equations" class="equation-img">
      <p>Type the five‚Äëletter password below to unlock the door:</p>
      <input id="password1" type="text" placeholder="Password">
      <button class="action-button" onclick="checkPassword(0)">Unlock</button>
      <!-- Cipher button opens the Level 1 cipher image in a new tab -->
      <button class="cipher-button" onclick="window.open('cipher1.png','_blank')">Cipher</button>
    </div>
  </div>

  <!-- Scene 2: The Hallway of Echoes -->
  <div id="section2" class="section">
    <div class="content">
      <h1>Scene&nbsp;2: The Hallway of Echoes</h1>
      <video controls poster="scene2.png">
        <source src="scene2.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="audio-controls">
        <audio id="music2" class="scene-audio" src="track2.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('music2', this)">Music On</button>
      </div>
      <p>The door creaks open, and you step into a red‚Äëlit hallway that stretches into the fog. Suddenly, a crazed clown teacher jumps out from a locker and then vanishes down the hall. Your heart races as you steady yourself. Messages scrawled on the lockers whisper:</p>
      <p style="font-size:1.2em; color:#e74c3c;">"It knows your mistakes."</p>
      <p>On the wall, more equations appear. Solve them, convert the numbers to letters, and unscramble to find the three‚Äëletter password.</p>
      <img src="equations2.png" alt="Level 2 equations" class="equation-img">
      <p>Type the password to hurry down the hall:</p>
      <input id="password2" type="text" placeholder="Password">
      <button class="action-button" onclick="checkPassword(1)">Continue</button>
      <button class="cipher-button" onclick="window.open('cipher2.png','_blank')">Cipher</button>
    </div>
  </div>

  <!-- Scene 3: The Lab Test -->
  <div id="section3" class="section">
    <div class="content">
      <h1>Scene&nbsp;3: The Lab Test</h1>
      <video controls poster="scene3.png">
        <source src="scene3.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="audio-controls">
        <audio id="music3" class="scene-audio" src="track3.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('music3', this)">Music On</button>
      </div>
      <p>You duck into a lab to hide. Papers float through the air, and you swear you see not only the clown but another monstrous figure lurking in the shadows. A cold voice from the intercom crackles:</p>
      <p style="font-size:1.2em; color:#e74c3c;">"Every wrong answer brings&nbsp;<em>them</em>&nbsp;closer."</p>
      <p>Solve each equation below. Convert each <em>x</em> value to a letter. Unscramble the six letters to find the password that will unlock the next door.</p>
      <img src="equations3.png" alt="Level 3 equations" class="equation-img">
      <p>Type the six‚Äëletter password to escape the lab:</p>
      <input id="password3" type="text" placeholder="Password">
      <button class="action-button" onclick="checkPassword(2)">Unlock</button>
      <button class="cipher-button" onclick="window.open('cipher3.png','_blank')">Cipher</button>
    </div>
  </div>

  <!-- Scene 4: The Final Problem -->
  <div id="section4" class="section">
    <div class="content">
      <h1>Scene&nbsp;4: The Final Problem</h1>
      <video controls poster="scene4.png">
        <source src="scene4.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="audio-controls">
        <audio id="music4" class="scene-audio" src="track4.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('music4', this)">Music On</button>
      </div>
      <p>The final classroom door slams shut behind you. As you catch your breath, the monster lunges at you in one last jump scare&nbsp;&mdash;&nbsp;then disappears, leaving you with a final set of equations. Papers whirl around as if caught in a storm. A shadow blocks the only exit. The voice whispers:</p>
      <p style="font-size:1.2em; color:#e74c3c;">"One last test. Get it right‚Ä¶ or repeat forever."</p>
      <p>Solve each equation, convert the numbers to letters, and unscramble the six letters to find the final password.</p>
      <img src="equations4.png" alt="Level 4 equations" class="equation-img">
      <p>Type the final six‚Äëletter password:</p>
      <input id="password4" type="text" placeholder="Password">
      <button class="action-button" onclick="checkPassword(3)">Unlock</button>
      <button class="cipher-button" onclick="window.open('cipher4.png','_blank')">Cipher</button>
    </div>
  </div>

  <!-- Success Section -->
  <div id="section_success" class="section">
    <div class="content">
      <h1>üèÅ You Escaped!</h1>
      <video controls poster="scene5.png">
        <source src="win.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="audio-controls">
        <audio id="musicWin" class="scene-audio" src="win.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('musicWin', this)">Music On</button>
      </div>
      <p>Sunlight floods the room. The nightmare fades. The clock finally ticks forward. You hear the intercom murmur, "Class dismissed."</p>
      <p>You solved every equation and escaped the Haunted Equation Escape. Or did you? As you turn to leave, you catch a glimpse of a shadowy grin in the reflection.</p>
      <button class="action-button restart" onclick="restart()">Play Again</button>
      <button class="action-button feedback" onclick="window.open('https://forms.gle/VvxLjUV8zoKRp3Mq9','_blank')">Feedback Survey</button>
    </div>
  </div>

  <!-- Fail Section -->
  <div id="section_fail" class="section">
    <div class="content">
      <h1>üíÄ Caught by the Monster</h1>
      <video controls poster="scene_fail.png">
        <source src="fail.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="audio-controls">
        <audio id="musicFail" class="scene-audio" src="fail.mp3" loop></audio>
        <button class="music-toggle" onclick="toggleAudio('musicFail', this)">Music On</button>
      </div>
      <p>The lights burst overhead. A tall, thin creature covered in cracked porcelain skin steps through the doorway. Its featureless mask splits into a jagged smile as it reaches out for you.</p>
      <p>You hear a voice: "Wrong answer. The lesson isn‚Äôt over." And then everything goes black.</p>
      <button class="action-button restart" onclick="restart()">Try Again</button>
      <button class="action-button feedback" onclick="window.open('https://forms.gle/VvxLjUV8zoKRp3Mq9','_blank')">Feedback Survey</button>
    </div>
  </div>

  <script>
    // Password sequence for each section
    const passwords = ['SOLVE', 'RUN', 'BREATH', 'ESCAPE'];

    // Show the first scene on page load
    window.onload = function() {
      document.getElementById('section1').style.display = 'block';
    };

    // Verify a password for the given index and transition accordingly
    function checkPassword(idx) {
      const input = document.getElementById('password' + (idx + 1));
      const value = (input.value || '').trim().toUpperCase();
      if (value === passwords[idx]) {
        // Stop any ongoing media before switching scenes
        stopAllMusic();
        stopAllVideos();
        // Hide current section
        document.getElementById('section' + (idx + 1)).style.display = 'none';
        // If more scenes remain, show next; otherwise show success
        if (idx + 1 < passwords.length) {
          document.getElementById('section' + (idx + 2)).style.display = 'block';
        } else {
          document.getElementById('section_success').style.display = 'block';
        }
      } else {
        // Wrong password: stop media and show fail screen
        stopAllMusic();
        stopAllVideos();
        document.getElementById('section' + (idx + 1)).style.display = 'none';
        document.getElementById('section_fail').style.display = 'block';
      }
    }

    // Restart the entire escape room
    function restart() {
      stopAllMusic();
      stopAllVideos();
      // Hide all sections
      const sections = document.querySelectorAll('.section');
      sections.forEach(sec => sec.style.display = 'none');
      // Clear all password inputs
      for (let i = 1; i <= passwords.length; i++) {
        const field = document.getElementById('password' + i);
        if (field) field.value = '';
      }
      // Show first section again
      document.getElementById('section1').style.display = 'block';
    }

    // Toggle play/pause on a specific audio track and update the button label
    function toggleAudio(id, btn) {
      const audio = document.getElementById(id);
      if (!audio) return;
      if (audio.paused) {
        stopAllMusic();
        audio.play();
        if (btn) btn.textContent = 'Music Off';
      } else {
        audio.pause();
        audio.currentTime = 0;
        if (btn) btn.textContent = 'Music On';
      }
    }

    // Pause and reset all audio tracks on the page and reset button labels
    function stopAllMusic() {
      const audios = document.querySelectorAll('audio.scene-audio');
      audios.forEach(a => {
        a.pause();
        a.currentTime = 0;
      });
      const buttons = document.querySelectorAll('.music-toggle');
      buttons.forEach(b => {
        b.textContent = 'Music On';
      });
    }

    // Pause and reset all video elements on the page
    function stopAllVideos() {
      const videos = document.querySelectorAll('video');
      videos.forEach(v => {
        v.pause();
        try { v.currentTime = 0; } catch (e) {}
      });
    }
  </script>
</body>
</html>
